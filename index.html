<!DOCTYPE html>
<html lang="id">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no" />
  <title>Pembukaan CIF - BPR Akasia Mas</title>

  <script type="module" src="https://cdn.jsdelivr.net/npm/@ionic/core/dist/ionic/ionic.esm.js"></script>
  <script nomodule src="https://cdn.jsdelivr.net/npm/@ionic/core/dist/ionic/ionic.js"></script>
  <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/@ionic/core/css/ionic.bundle.css" />

  <style>
    /* Custom Branding BPR Akasia Mas */
    :root {
      --ion-color-primary: #0d6efd; /* Biru Bank */
      --ion-color-primary-contrast: #ffffff;
    }
    
    .header-logo {
      font-weight: 800;
      color: var(--ion-color-primary);
      letter-spacing: 0.5px;
    }

    /* Agar form terasa luas di HP */
    ion-content {
      --background: #f4f5f8;
    }
    
    .section-title {
      padding-left: 16px;
      padding-top: 20px;
      font-size: 13px;
      font-weight: 600;
      color: #666;
      text-transform: uppercase;
      letter-spacing: 1px;
    }
    
    .hint-text {
      font-size: 11px;
      color: #888;
      margin-top: 5px;
    }
  </style>
</head>
<body>

  <ion-app>
    <ion-header translucent="true">
      <ion-toolbar>
        <ion-title class="header-logo">BPR AKASIA MAS</ion-title>
      </ion-toolbar>
    </ion-header>

    <ion-content fullscreen="true">
      
      <form id="cifForm">
        
        <div class="section-title">Kategori Nasabah</div>
        <ion-list inset="true">
          <ion-radio-group name="kategori_nasabah" value="Nasabah Baru">
            <ion-item>
              <ion-label>Nasabah Baru</ion-label>
              <ion-radio slot="end" value="Nasabah Baru"></ion-radio>
            </ion-item>
            <ion-item>
              <ion-label>Pengkinian Data</ion-label>
              <ion-radio slot="end" value="Pengkinian Data"></ion-radio>
            </ion-item>
          </ion-radio-group>
        </ion-list>

        <div class="section-title">Sumber Data</div>
        <ion-list inset="true">
          <ion-select label="Informasi Dari Mana?" placeholder="Pilih Sumber" name="sumber_data" id="sumberDataSelect">
            <ion-select-option value="Website">Website</ion-select-option>
            <ion-select-option value="Brosur">Brosur</ion-select-option>
            <ion-select-option value="Lainnya">Lainnya</ion-select-option>
          </ion-select>
          
          <ion-item id="inputLainnya" style="display: none;">
            <ion-input label="Sebutkan sumber:" label-placement="floating" name="sumber_data_lainnya" placeholder="..."></ion-input>
          </ion-item>
        </ion-list>

        <div class="section-title">Data Diri (Sesuai KTP)</div>
        <ion-list inset="true">
          <ion-item>
            <ion-input label="Nama Lengkap" label-placement="floating" name="nama_lengkap" placeholder="Sesuai KTP" required></ion-input>
          </ion-item>
          <ion-item>
            <ion-input label="Nama Alias" label-placement="floating" name="nama_alias" placeholder="Nama Panggilan"></ion-input>
          </ion-item>
          <ion-item>
            <ion-input label="NIK (KTP)" type="number" label-placement="floating" name="NIK" required></ion-input>
          </ion-item>
          <ion-item>
            <ion-textarea label="Alamat KTP" label-placement="floating" name="alamat_ktp" rows="2" placeholder="Jalan, No Rumah"></ion-textarea>
          </ion-item>
          <ion-grid>
            <ion-row>
              <ion-col>
                <ion-input fill="solid" label="RT/RW" label-placement="stacked" name="rtrw_ktp"></ion-input>
              </ion-col>
              <ion-col>
                <ion-input fill="solid" label="Kode Pos" type="number" label-placement="stacked" name="kodepos_ktp"></ion-input>
              </ion-col>
            </ion-row>
          </ion-grid>
          <ion-item>
            <ion-input label="Kelurahan" label-placement="floating" name="kelurahan_ktp"></ion-input>
          </ion-item>
          <ion-item>
            <ion-input label="Kecamatan" label-placement="floating" name="kecamatan_ktp"></ion-input>
          </ion-item>
          <ion-item>
            <ion-input label="Kota/Kab" label-placement="floating" name="kota_ktp"></ion-input>
          </ion-item>
        </ion-list>

        <div class="section-title">Domisili</div>
        <ion-list inset="true">
          <ion-item lines="none">
            <ion-label class="ion-text-wrap" style="font-size: 14px;">Apakah alamat tinggal saat ini sama dengan KTP?</ion-label>
          </ion-item>
          <ion-segment value="Tidak" id="segmentDomisili">
            <ion-segment-button value="Iya">
              <ion-label>Iya, Sama</ion-label>
            </ion-segment-button>
            <ion-segment-button value="Tidak">
              <ion-label>Tidak / Beda</ion-label>
            </ion-segment-button>
          </ion-segment>
          
          <input type="hidden" name="alamat_sama_status" id="statusDomisiliVal" value="Tidak">
        </ion-list>

        <div id="formDomisili">
          <div class="section-title">Alamat Tempat Tinggal Sekarang</div>
          <ion-list inset="true">
            <ion-item>
              <ion-textarea label="Alamat Domisili" label-placement="floating" name="alamat_domisili"></ion-textarea>
            </ion-item>
             <ion-grid>
                <ion-row>
                  <ion-col>
                    <ion-input fill="solid" label="Kelurahan" label-placement="stacked" name="kelurahan_domisili"></ion-input>
                  </ion-col>
                  <ion-col>
                    <ion-input fill="solid" label="Kota" label-placement="stacked" name="kota_domisili"></ion-input>
                  </ion-col>
                </ion-row>
             </ion-grid>
             <ion-item>
                <ion-input label="No HP / WA" type="tel" label-placement="floating" name="no_telp" required></ion-input>
             </ion-item>
          </ion-list>
        </div>

        <div class="ion-padding">
          <ion-button expand="block" type="submit" size="large">Kirim Data Nasabah</ion-button>
        </div>

        <div class="ion-text-center ion-padding-bottom">
          <small style="color: #999;">&copy; IT BPR Akasia Mas 2024</small>
        </div>

      </form>
    </ion-content>
  </ion-app>

  <script>
    // --- KONFIGURASI ---
    const scriptURL = 'https://script.google.com/macros/s/AKfycbwFzduyB983KRtFOtZZXezt0oAE4uXYN6YnxcPhdCdQmsY7_aGZOBv4PvlH7nfm8z4AuQ/exec'; 
    // -------------------

    const form = document.getElementById('cifForm');
    const segmentDomisili = document.getElementById('segmentDomisili');
    const formDomisili = document.getElementById('formDomisili');
    const statusDomisiliVal = document.getElementById('statusDomisiliVal');
    const sumberSelect = document.getElementById('sumberDataSelect');
    const inputLainnya = document.getElementById('inputLainnya');

    // 1. Logika Tampilan Domisili
    segmentDomisili.addEventListener('ionChange', (e) => {
      const val = e.detail.value;
      statusDomisiliVal.value = val; // Update hidden input untuk Excel

      if (val === 'Iya') {
        formDomisili.style.display = 'none';
        // Hapus required agar bisa submit
        formDomisili.querySelectorAll('ion-input, ion-textarea').forEach(el => el.required = false);
      } else {
        formDomisili.style.display = 'block';
      }
    });

    // 2. Logika Tampilan Sumber Data Lainnya
    sumberSelect.addEventListener('ionChange', (e) => {
      if(e.detail.value === 'Lainnya') {
        inputLainnya.style.display = 'block';
      } else {
        inputLainnya.style.display = 'none';
      }
    });

    // 3. Handle Submit dengan Loading & Alert Khas Mobile
    form.addEventListener('submit', async (e) => {
      e.preventDefault();

      // Tampilkan Loading
      const loading = document.createElement('ion-loading');
      loading.message = 'Mengirim Data ke Pusat...';
      loading.duration = 10000; // Timeout safety
      document.body.appendChild(loading);
      await loading.present();

      // Persiapkan Data
      // Trik: Mengambil data dari komponen Ionic
      const formData = new FormData(form);

      try {
        const response = await fetch(scriptURL, { method: 'POST', body: formData });
        await loading.dismiss();

        // Tampilkan Sukses Alert
        const alert = document.createElement('ion-alert');
        alert.header = 'Berhasil!';
        alert.subHeader = 'Terima Kasih';
        alert.message = 'Data pembukaan CIF telah diterima sistem BPR Akasia Mas.';
        alert.buttons = ['OK'];
        document.body.appendChild(alert);
        await alert.present();

        form.reset(); // Reset Form
        segmentDomisili.value = 'Tidak'; // Reset logika

      } catch (error) {
        await loading.dismiss();
        const alert = document.createElement('ion-alert');
        alert.header = 'Gagal';
        alert.message = 'Terjadi kesalahan koneksi. Silakan coba lagi.';
        alert.buttons = ['Tutup'];
        document.body.appendChild(alert);
        await alert.present();
        console.error('Error!', error.message);
      }
    });
  </script>
</body>
</html>
